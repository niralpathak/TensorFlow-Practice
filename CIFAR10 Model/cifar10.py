<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>tensorflow/models/image/cifar10/cifar10.py - tensorflow - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.tUfpZ_-FMSB5BV8sDJSOrw.cache.css"><link rel="stylesheet" type="text/css" href="/+static/prettify/prettify.pZ5FqzM6cPxAflH0va2Ucw.cache.css"></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://www.google.com/a/SelectSession?service=gerritcodereview&amp;continue=https://tensorflow.googlesource.com/login/tensorflow/%2B/master/tensorflow/models/image/cifar10/cifar10.py">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">tensorflow</a> / <a class="Breadcrumbs-crumb" href="/tensorflow/">tensorflow</a> / <a class="Breadcrumbs-crumb" href="/tensorflow/+/master">master</a> / <a class="Breadcrumbs-crumb" href="/tensorflow/+/master/">.</a> / <a class="Breadcrumbs-crumb" href="/tensorflow/+/master/tensorflow">tensorflow</a> / <a class="Breadcrumbs-crumb" href="/tensorflow/+/master/tensorflow/models">models</a> / <a class="Breadcrumbs-crumb" href="/tensorflow/+/master/tensorflow/models/image">image</a> / <a class="Breadcrumbs-crumb" href="/tensorflow/+/master/tensorflow/models/image/cifar10">cifar10</a> / <span class="Breadcrumbs-crumb">cifar10.py</span></div><div class="u-sha1 u-monospace BlobSha1">blob: ef89becf52dfc67c5d53a614474124ec74c35a4c [<a href="/tensorflow/+/master/tensorflow/models/image/cifar10/cifar10.py">file</a>] [<a href="/tensorflow/+log/master/tensorflow/models/image/cifar10/cifar10.py">log</a>] [<a href="/tensorflow/+blame/master/tensorflow/models/image/cifar10/cifar10.py">blame</a>]</div><table class="FileContents"><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="1" onclick="window.location.hash='#1'"></td><td class="FileContents-lineContents"><a name="1"></a><span class="com"># Copyright 2015 Google Inc. All Rights Reserved.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="2" onclick="window.location.hash='#2'"></td><td class="FileContents-lineContents"><a name="2"></a><span class="com">#</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="3" onclick="window.location.hash='#3'"></td><td class="FileContents-lineContents"><a name="3"></a><span class="com"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="4" onclick="window.location.hash='#4'"></td><td class="FileContents-lineContents"><a name="4"></a><span class="com"># you may not use this file except in compliance with the License.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="5" onclick="window.location.hash='#5'"></td><td class="FileContents-lineContents"><a name="5"></a><span class="com"># You may obtain a copy of the License at</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="6" onclick="window.location.hash='#6'"></td><td class="FileContents-lineContents"><a name="6"></a><span class="com">#</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="7" onclick="window.location.hash='#7'"></td><td class="FileContents-lineContents"><a name="7"></a><span class="com">#     http://www.apache.org/licenses/LICENSE-2.0</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="8" onclick="window.location.hash='#8'"></td><td class="FileContents-lineContents"><a name="8"></a><span class="com">#</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="9" onclick="window.location.hash='#9'"></td><td class="FileContents-lineContents"><a name="9"></a><span class="com"># Unless required by applicable law or agreed to in writing, software</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="10" onclick="window.location.hash='#10'"></td><td class="FileContents-lineContents"><a name="10"></a><span class="com"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="11" onclick="window.location.hash='#11'"></td><td class="FileContents-lineContents"><a name="11"></a><span class="com"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="12" onclick="window.location.hash='#12'"></td><td class="FileContents-lineContents"><a name="12"></a><span class="com"># See the License for the specific language governing permissions and</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="13" onclick="window.location.hash='#13'"></td><td class="FileContents-lineContents"><a name="13"></a><span class="com"># limitations under the License.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="14" onclick="window.location.hash='#14'"></td><td class="FileContents-lineContents"><a name="14"></a><span class="com"># ==============================================================================</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="15" onclick="window.location.hash='#15'"></td><td class="FileContents-lineContents"><a name="15"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="16" onclick="window.location.hash='#16'"></td><td class="FileContents-lineContents"><a name="16"></a><span class="str">&quot;&quot;&quot;Builds the CIFAR-10 network.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="17" onclick="window.location.hash='#17'"></td><td class="FileContents-lineContents"><a name="17"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="18" onclick="window.location.hash='#18'"></td><td class="FileContents-lineContents"><a name="18"></a><span class="str">Summary of available functions:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="19" onclick="window.location.hash='#19'"></td><td class="FileContents-lineContents"><a name="19"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="20" onclick="window.location.hash='#20'"></td><td class="FileContents-lineContents"><a name="20"></a><span class="str"> # Compute input images and labels for training. If you would like to run</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="21" onclick="window.location.hash='#21'"></td><td class="FileContents-lineContents"><a name="21"></a><span class="str"> # evaluations, use input() instead.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="22" onclick="window.location.hash='#22'"></td><td class="FileContents-lineContents"><a name="22"></a><span class="str"> inputs, labels = distorted_inputs()</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="23" onclick="window.location.hash='#23'"></td><td class="FileContents-lineContents"><a name="23"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="24" onclick="window.location.hash='#24'"></td><td class="FileContents-lineContents"><a name="24"></a><span class="str"> # Compute inference on the model inputs to make a prediction.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="25" onclick="window.location.hash='#25'"></td><td class="FileContents-lineContents"><a name="25"></a><span class="str"> predictions = inference(inputs)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="26" onclick="window.location.hash='#26'"></td><td class="FileContents-lineContents"><a name="26"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="27" onclick="window.location.hash='#27'"></td><td class="FileContents-lineContents"><a name="27"></a><span class="str"> # Compute the total loss of the prediction with respect to the labels.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="28" onclick="window.location.hash='#28'"></td><td class="FileContents-lineContents"><a name="28"></a><span class="str"> loss = loss(predictions, labels)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="29" onclick="window.location.hash='#29'"></td><td class="FileContents-lineContents"><a name="29"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="30" onclick="window.location.hash='#30'"></td><td class="FileContents-lineContents"><a name="30"></a><span class="str"> # Create a graph to run one step of training with respect to the loss.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="31" onclick="window.location.hash='#31'"></td><td class="FileContents-lineContents"><a name="31"></a><span class="str"> train_op = train(loss, global_step)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="32" onclick="window.location.hash='#32'"></td><td class="FileContents-lineContents"><a name="32"></a><span class="str">&quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="33" onclick="window.location.hash='#33'"></td><td class="FileContents-lineContents"><a name="33"></a><span class="com"># pylint: disable=missing-docstring</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="34" onclick="window.location.hash='#34'"></td><td class="FileContents-lineContents"><a name="34"></a><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> absolute_import</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="35" onclick="window.location.hash='#35'"></td><td class="FileContents-lineContents"><a name="35"></a><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> division</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="36" onclick="window.location.hash='#36'"></td><td class="FileContents-lineContents"><a name="36"></a><span class="kwd">from</span><span class="pln"> __future__ </span><span class="kwd">import</span><span class="pln"> print_function</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="37" onclick="window.location.hash='#37'"></td><td class="FileContents-lineContents"><a name="37"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="38" onclick="window.location.hash='#38'"></td><td class="FileContents-lineContents"><a name="38"></a><span class="kwd">import</span><span class="pln"> gzip</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="39" onclick="window.location.hash='#39'"></td><td class="FileContents-lineContents"><a name="39"></a><span class="kwd">import</span><span class="pln"> os</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="40" onclick="window.location.hash='#40'"></td><td class="FileContents-lineContents"><a name="40"></a><span class="kwd">import</span><span class="pln"> re</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="41" onclick="window.location.hash='#41'"></td><td class="FileContents-lineContents"><a name="41"></a><span class="kwd">import</span><span class="pln"> sys</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="42" onclick="window.location.hash='#42'"></td><td class="FileContents-lineContents"><a name="42"></a><span class="kwd">import</span><span class="pln"> tarfile</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="43" onclick="window.location.hash='#43'"></td><td class="FileContents-lineContents"><a name="43"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="44" onclick="window.location.hash='#44'"></td><td class="FileContents-lineContents"><a name="44"></a><span class="kwd">import</span><span class="pln"> tensorflow</span><span class="pun">.</span><span class="pln">python</span><span class="pun">.</span><span class="pln">platform</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="45" onclick="window.location.hash='#45'"></td><td class="FileContents-lineContents"><a name="45"></a><span class="kwd">from</span><span class="pln"> six</span><span class="pun">.</span><span class="pln">moves </span><span class="kwd">import</span><span class="pln"> urllib</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="46" onclick="window.location.hash='#46'"></td><td class="FileContents-lineContents"><a name="46"></a><span class="kwd">import</span><span class="pln"> tensorflow </span><span class="kwd">as</span><span class="pln"> tf</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="47" onclick="window.location.hash='#47'"></td><td class="FileContents-lineContents"><a name="47"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="48" onclick="window.location.hash='#48'"></td><td class="FileContents-lineContents"><a name="48"></a><span class="kwd">from</span><span class="pln"> tensorflow</span><span class="pun">.</span><span class="pln">models</span><span class="pun">.</span><span class="pln">image</span><span class="pun">.</span><span class="pln">cifar10 </span><span class="kwd">import</span><span class="pln"> cifar10_input</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="49" onclick="window.location.hash='#49'"></td><td class="FileContents-lineContents"><a name="49"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="50" onclick="window.location.hash='#50'"></td><td class="FileContents-lineContents"><a name="50"></a><span class="pln">FLAGS </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="pln">flags</span><span class="pun">.</span><span class="pln">FLAGS</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="51" onclick="window.location.hash='#51'"></td><td class="FileContents-lineContents"><a name="51"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="52" onclick="window.location.hash='#52'"></td><td class="FileContents-lineContents"><a name="52"></a><span class="com"># Basic model parameters.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="53" onclick="window.location.hash='#53'"></td><td class="FileContents-lineContents"><a name="53"></a><span class="pln">tf</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="pln">flags</span><span class="pun">.</span><span class="pln">DEFINE_integer</span><span class="pun">(</span><span class="str">&#39;batch_size&#39;</span><span class="pun">,</span><span class="pln"> </span><span class="lit">128</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="54" onclick="window.location.hash='#54'"></td><td class="FileContents-lineContents"><a name="54"></a><span class="pln">                            </span><span class="str">&quot;&quot;&quot;Number of images to process in a batch.&quot;&quot;&quot;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="55" onclick="window.location.hash='#55'"></td><td class="FileContents-lineContents"><a name="55"></a><span class="pln">tf</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="pln">flags</span><span class="pun">.</span><span class="pln">DEFINE_string</span><span class="pun">(</span><span class="str">&#39;data_dir&#39;</span><span class="pun">,</span><span class="pln"> </span><span class="str">&#39;/tmp/cifar10_data&#39;</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="56" onclick="window.location.hash='#56'"></td><td class="FileContents-lineContents"><a name="56"></a><span class="pln">                           </span><span class="str">&quot;&quot;&quot;Path to the CIFAR-10 data directory.&quot;&quot;&quot;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="57" onclick="window.location.hash='#57'"></td><td class="FileContents-lineContents"><a name="57"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="58" onclick="window.location.hash='#58'"></td><td class="FileContents-lineContents"><a name="58"></a><span class="com"># Global constants describing the CIFAR-10 data set.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="59" onclick="window.location.hash='#59'"></td><td class="FileContents-lineContents"><a name="59"></a><span class="pln">IMAGE_SIZE </span><span class="pun">=</span><span class="pln"> cifar10_input</span><span class="pun">.</span><span class="pln">IMAGE_SIZE</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="60" onclick="window.location.hash='#60'"></td><td class="FileContents-lineContents"><a name="60"></a><span class="pln">NUM_CLASSES </span><span class="pun">=</span><span class="pln"> cifar10_input</span><span class="pun">.</span><span class="pln">NUM_CLASSES</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="61" onclick="window.location.hash='#61'"></td><td class="FileContents-lineContents"><a name="61"></a><span class="pln">NUM_EXAMPLES_PER_EPOCH_FOR_TRAIN </span><span class="pun">=</span><span class="pln"> cifar10_input</span><span class="pun">.</span><span class="pln">NUM_EXAMPLES_PER_EPOCH_FOR_TRAIN</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="62" onclick="window.location.hash='#62'"></td><td class="FileContents-lineContents"><a name="62"></a><span class="pln">NUM_EXAMPLES_PER_EPOCH_FOR_EVAL </span><span class="pun">=</span><span class="pln"> cifar10_input</span><span class="pun">.</span><span class="pln">NUM_EXAMPLES_PER_EPOCH_FOR_EVAL</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="63" onclick="window.location.hash='#63'"></td><td class="FileContents-lineContents"><a name="63"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="64" onclick="window.location.hash='#64'"></td><td class="FileContents-lineContents"><a name="64"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="65" onclick="window.location.hash='#65'"></td><td class="FileContents-lineContents"><a name="65"></a><span class="com"># Constants describing the training process.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="66" onclick="window.location.hash='#66'"></td><td class="FileContents-lineContents"><a name="66"></a><span class="pln">MOVING_AVERAGE_DECAY </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.9999</span><span class="pln">     </span><span class="com"># The decay to use for the moving average.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="67" onclick="window.location.hash='#67'"></td><td class="FileContents-lineContents"><a name="67"></a><span class="pln">NUM_EPOCHS_PER_DECAY </span><span class="pun">=</span><span class="pln"> </span><span class="lit">350.0</span><span class="pln">      </span><span class="com"># Epochs after which learning rate decays.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="68" onclick="window.location.hash='#68'"></td><td class="FileContents-lineContents"><a name="68"></a><span class="pln">LEARNING_RATE_DECAY_FACTOR </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.1</span><span class="pln">  </span><span class="com"># Learning rate decay factor.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="69" onclick="window.location.hash='#69'"></td><td class="FileContents-lineContents"><a name="69"></a><span class="pln">INITIAL_LEARNING_RATE </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.1</span><span class="pln">       </span><span class="com"># Initial learning rate.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="70" onclick="window.location.hash='#70'"></td><td class="FileContents-lineContents"><a name="70"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="71" onclick="window.location.hash='#71'"></td><td class="FileContents-lineContents"><a name="71"></a><span class="com"># If a model is trained with multiple GPU&#39;s prefix all Op names with tower_name</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="72" onclick="window.location.hash='#72'"></td><td class="FileContents-lineContents"><a name="72"></a><span class="com"># to differentiate the operations. Note that this prefix is removed from the</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="73" onclick="window.location.hash='#73'"></td><td class="FileContents-lineContents"><a name="73"></a><span class="com"># names of the summaries when visualizing a model.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="74" onclick="window.location.hash='#74'"></td><td class="FileContents-lineContents"><a name="74"></a><span class="pln">TOWER_NAME </span><span class="pun">=</span><span class="pln"> </span><span class="str">&#39;tower&#39;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="75" onclick="window.location.hash='#75'"></td><td class="FileContents-lineContents"><a name="75"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="76" onclick="window.location.hash='#76'"></td><td class="FileContents-lineContents"><a name="76"></a><span class="pln">DATA_URL </span><span class="pun">=</span><span class="pln"> </span><span class="str">&#39;http://www.cs.toronto.edu/~kriz/cifar-10-binary.tar.gz&#39;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="77" onclick="window.location.hash='#77'"></td><td class="FileContents-lineContents"><a name="77"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="78" onclick="window.location.hash='#78'"></td><td class="FileContents-lineContents"><a name="78"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="79" onclick="window.location.hash='#79'"></td><td class="FileContents-lineContents"><a name="79"></a><span class="kwd">def</span><span class="pln"> _activation_summary</span><span class="pun">(</span><span class="pln">x</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="80" onclick="window.location.hash='#80'"></td><td class="FileContents-lineContents"><a name="80"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Helper to create summaries for activations.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="81" onclick="window.location.hash='#81'"></td><td class="FileContents-lineContents"><a name="81"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="82" onclick="window.location.hash='#82'"></td><td class="FileContents-lineContents"><a name="82"></a><span class="str">  Creates a summary that provides a histogram of activations.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="83" onclick="window.location.hash='#83'"></td><td class="FileContents-lineContents"><a name="83"></a><span class="str">  Creates a summary that measure the sparsity of activations.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="84" onclick="window.location.hash='#84'"></td><td class="FileContents-lineContents"><a name="84"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="85" onclick="window.location.hash='#85'"></td><td class="FileContents-lineContents"><a name="85"></a><span class="str">  Args:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="86" onclick="window.location.hash='#86'"></td><td class="FileContents-lineContents"><a name="86"></a><span class="str">    x: Tensor</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="87" onclick="window.location.hash='#87'"></td><td class="FileContents-lineContents"><a name="87"></a><span class="str">  Returns:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="88" onclick="window.location.hash='#88'"></td><td class="FileContents-lineContents"><a name="88"></a><span class="str">    nothing</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="89" onclick="window.location.hash='#89'"></td><td class="FileContents-lineContents"><a name="89"></a><span class="str">  &quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="90" onclick="window.location.hash='#90'"></td><td class="FileContents-lineContents"><a name="90"></a><span class="pln">  </span><span class="com"># Remove &#39;tower_[0-9]/&#39; from the name in case this is a multi-GPU training</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="91" onclick="window.location.hash='#91'"></td><td class="FileContents-lineContents"><a name="91"></a><span class="pln">  </span><span class="com"># session. This helps the clarity of presentation on tensorboard.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="92" onclick="window.location.hash='#92'"></td><td class="FileContents-lineContents"><a name="92"></a><span class="pln">  tensor_name </span><span class="pun">=</span><span class="pln"> re</span><span class="pun">.</span><span class="pln">sub</span><span class="pun">(</span><span class="str">&#39;%s_[0-9]*/&#39;</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> TOWER_NAME</span><span class="pun">,</span><span class="pln"> </span><span class="str">&#39;&#39;</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">.</span><span class="pln">op</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="93" onclick="window.location.hash='#93'"></td><td class="FileContents-lineContents"><a name="93"></a><span class="pln">  tf</span><span class="pun">.</span><span class="pln">histogram_summary</span><span class="pun">(</span><span class="pln">tensor_name </span><span class="pun">+</span><span class="pln"> </span><span class="str">&#39;/activations&#39;</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="94" onclick="window.location.hash='#94'"></td><td class="FileContents-lineContents"><a name="94"></a><span class="pln">  tf</span><span class="pun">.</span><span class="pln">scalar_summary</span><span class="pun">(</span><span class="pln">tensor_name </span><span class="pun">+</span><span class="pln"> </span><span class="str">&#39;/sparsity&#39;</span><span class="pun">,</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">zero_fraction</span><span class="pun">(</span><span class="pln">x</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="95" onclick="window.location.hash='#95'"></td><td class="FileContents-lineContents"><a name="95"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="96" onclick="window.location.hash='#96'"></td><td class="FileContents-lineContents"><a name="96"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="97" onclick="window.location.hash='#97'"></td><td class="FileContents-lineContents"><a name="97"></a><span class="kwd">def</span><span class="pln"> _variable_on_cpu</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> shape</span><span class="pun">,</span><span class="pln"> initializer</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="98" onclick="window.location.hash='#98'"></td><td class="FileContents-lineContents"><a name="98"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Helper to create a Variable stored on CPU memory.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="99" onclick="window.location.hash='#99'"></td><td class="FileContents-lineContents"><a name="99"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="100" onclick="window.location.hash='#100'"></td><td class="FileContents-lineContents"><a name="100"></a><span class="str">  Args:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="101" onclick="window.location.hash='#101'"></td><td class="FileContents-lineContents"><a name="101"></a><span class="str">    name: name of the variable</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="102" onclick="window.location.hash='#102'"></td><td class="FileContents-lineContents"><a name="102"></a><span class="str">    shape: list of ints</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="103" onclick="window.location.hash='#103'"></td><td class="FileContents-lineContents"><a name="103"></a><span class="str">    initializer: initializer for Variable</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="104" onclick="window.location.hash='#104'"></td><td class="FileContents-lineContents"><a name="104"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="105" onclick="window.location.hash='#105'"></td><td class="FileContents-lineContents"><a name="105"></a><span class="str">  Returns:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="106" onclick="window.location.hash='#106'"></td><td class="FileContents-lineContents"><a name="106"></a><span class="str">    Variable Tensor</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="107" onclick="window.location.hash='#107'"></td><td class="FileContents-lineContents"><a name="107"></a><span class="str">  &quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="108" onclick="window.location.hash='#108'"></td><td class="FileContents-lineContents"><a name="108"></a><span class="pln">  </span><span class="kwd">with</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">device</span><span class="pun">(</span><span class="str">&#39;/cpu:0&#39;</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="109" onclick="window.location.hash='#109'"></td><td class="FileContents-lineContents"><a name="109"></a><span class="pln">    var </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">get_variable</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> shape</span><span class="pun">,</span><span class="pln"> initializer</span><span class="pun">=</span><span class="pln">initializer</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="110" onclick="window.location.hash='#110'"></td><td class="FileContents-lineContents"><a name="110"></a><span class="pln">  </span><span class="kwd">return</span><span class="pln"> var</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="111" onclick="window.location.hash='#111'"></td><td class="FileContents-lineContents"><a name="111"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="112" onclick="window.location.hash='#112'"></td><td class="FileContents-lineContents"><a name="112"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="113" onclick="window.location.hash='#113'"></td><td class="FileContents-lineContents"><a name="113"></a><span class="kwd">def</span><span class="pln"> _variable_with_weight_decay</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> shape</span><span class="pun">,</span><span class="pln"> stddev</span><span class="pun">,</span><span class="pln"> wd</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="114" onclick="window.location.hash='#114'"></td><td class="FileContents-lineContents"><a name="114"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Helper to create an initialized Variable with weight decay.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="115" onclick="window.location.hash='#115'"></td><td class="FileContents-lineContents"><a name="115"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="116" onclick="window.location.hash='#116'"></td><td class="FileContents-lineContents"><a name="116"></a><span class="str">  Note that the Variable is initialized with a truncated normal distribution.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="117" onclick="window.location.hash='#117'"></td><td class="FileContents-lineContents"><a name="117"></a><span class="str">  A weight decay is added only if one is specified.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="118" onclick="window.location.hash='#118'"></td><td class="FileContents-lineContents"><a name="118"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="119" onclick="window.location.hash='#119'"></td><td class="FileContents-lineContents"><a name="119"></a><span class="str">  Args:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="120" onclick="window.location.hash='#120'"></td><td class="FileContents-lineContents"><a name="120"></a><span class="str">    name: name of the variable</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="121" onclick="window.location.hash='#121'"></td><td class="FileContents-lineContents"><a name="121"></a><span class="str">    shape: list of ints</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="122" onclick="window.location.hash='#122'"></td><td class="FileContents-lineContents"><a name="122"></a><span class="str">    stddev: standard deviation of a truncated Gaussian</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="123" onclick="window.location.hash='#123'"></td><td class="FileContents-lineContents"><a name="123"></a><span class="str">    wd: add L2Loss weight decay multiplied by this float. If None, weight</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="124" onclick="window.location.hash='#124'"></td><td class="FileContents-lineContents"><a name="124"></a><span class="str">        decay is not added for this Variable.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="125" onclick="window.location.hash='#125'"></td><td class="FileContents-lineContents"><a name="125"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="126" onclick="window.location.hash='#126'"></td><td class="FileContents-lineContents"><a name="126"></a><span class="str">  Returns:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="127" onclick="window.location.hash='#127'"></td><td class="FileContents-lineContents"><a name="127"></a><span class="str">    Variable Tensor</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="128" onclick="window.location.hash='#128'"></td><td class="FileContents-lineContents"><a name="128"></a><span class="str">  &quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="129" onclick="window.location.hash='#129'"></td><td class="FileContents-lineContents"><a name="129"></a><span class="pln">  var </span><span class="pun">=</span><span class="pln"> _variable_on_cpu</span><span class="pun">(</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> shape</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="130" onclick="window.location.hash='#130'"></td><td class="FileContents-lineContents"><a name="130"></a><span class="pln">                         tf</span><span class="pun">.</span><span class="pln">truncated_normal_initializer</span><span class="pun">(</span><span class="pln">stddev</span><span class="pun">=</span><span class="pln">stddev</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="131" onclick="window.location.hash='#131'"></td><td class="FileContents-lineContents"><a name="131"></a><span class="pln">  </span><span class="kwd">if</span><span class="pln"> wd</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="132" onclick="window.location.hash='#132'"></td><td class="FileContents-lineContents"><a name="132"></a><span class="pln">    weight_decay </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">mul</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">l2_loss</span><span class="pun">(</span><span class="pln">var</span><span class="pun">),</span><span class="pln"> wd</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="str">&#39;weight_loss&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="133" onclick="window.location.hash='#133'"></td><td class="FileContents-lineContents"><a name="133"></a><span class="pln">    tf</span><span class="pun">.</span><span class="pln">add_to_collection</span><span class="pun">(</span><span class="str">&#39;losses&#39;</span><span class="pun">,</span><span class="pln"> weight_decay</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="134" onclick="window.location.hash='#134'"></td><td class="FileContents-lineContents"><a name="134"></a><span class="pln">  </span><span class="kwd">return</span><span class="pln"> var</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="135" onclick="window.location.hash='#135'"></td><td class="FileContents-lineContents"><a name="135"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="136" onclick="window.location.hash='#136'"></td><td class="FileContents-lineContents"><a name="136"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="137" onclick="window.location.hash='#137'"></td><td class="FileContents-lineContents"><a name="137"></a><span class="kwd">def</span><span class="pln"> distorted_inputs</span><span class="pun">():</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="138" onclick="window.location.hash='#138'"></td><td class="FileContents-lineContents"><a name="138"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Construct distorted input for CIFAR training using the Reader ops.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="139" onclick="window.location.hash='#139'"></td><td class="FileContents-lineContents"><a name="139"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="140" onclick="window.location.hash='#140'"></td><td class="FileContents-lineContents"><a name="140"></a><span class="str">  Returns:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="141" onclick="window.location.hash='#141'"></td><td class="FileContents-lineContents"><a name="141"></a><span class="str">    images: Images. 4D tensor of [batch_size, IMAGE_SIZE, IMAGE_SIZE, 3] size.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="142" onclick="window.location.hash='#142'"></td><td class="FileContents-lineContents"><a name="142"></a><span class="str">    labels: Labels. 1D tensor of [batch_size] size.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="143" onclick="window.location.hash='#143'"></td><td class="FileContents-lineContents"><a name="143"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="144" onclick="window.location.hash='#144'"></td><td class="FileContents-lineContents"><a name="144"></a><span class="str">  Raises:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="145" onclick="window.location.hash='#145'"></td><td class="FileContents-lineContents"><a name="145"></a><span class="str">    ValueError: If no data_dir</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="146" onclick="window.location.hash='#146'"></td><td class="FileContents-lineContents"><a name="146"></a><span class="str">  &quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="147" onclick="window.location.hash='#147'"></td><td class="FileContents-lineContents"><a name="147"></a><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> FLAGS</span><span class="pun">.</span><span class="pln">data_dir</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="148" onclick="window.location.hash='#148'"></td><td class="FileContents-lineContents"><a name="148"></a><span class="pln">    </span><span class="kwd">raise</span><span class="pln"> </span><span class="typ">ValueError</span><span class="pun">(</span><span class="str">&#39;Please supply a data_dir&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="149" onclick="window.location.hash='#149'"></td><td class="FileContents-lineContents"><a name="149"></a><span class="pln">  data_dir </span><span class="pun">=</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">FLAGS</span><span class="pun">.</span><span class="pln">data_dir</span><span class="pun">,</span><span class="pln"> </span><span class="str">&#39;cifar-10-batches-bin&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="150" onclick="window.location.hash='#150'"></td><td class="FileContents-lineContents"><a name="150"></a><span class="pln">  </span><span class="kwd">return</span><span class="pln"> cifar10_input</span><span class="pun">.</span><span class="pln">distorted_inputs</span><span class="pun">(</span><span class="pln">data_dir</span><span class="pun">=</span><span class="pln">data_dir</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="151" onclick="window.location.hash='#151'"></td><td class="FileContents-lineContents"><a name="151"></a><span class="pln">                                        batch_size</span><span class="pun">=</span><span class="pln">FLAGS</span><span class="pun">.</span><span class="pln">batch_size</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="152" onclick="window.location.hash='#152'"></td><td class="FileContents-lineContents"><a name="152"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="153" onclick="window.location.hash='#153'"></td><td class="FileContents-lineContents"><a name="153"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="154" onclick="window.location.hash='#154'"></td><td class="FileContents-lineContents"><a name="154"></a><span class="kwd">def</span><span class="pln"> inputs</span><span class="pun">(</span><span class="pln">eval_data</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="155" onclick="window.location.hash='#155'"></td><td class="FileContents-lineContents"><a name="155"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Construct input for CIFAR evaluation using the Reader ops.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="156" onclick="window.location.hash='#156'"></td><td class="FileContents-lineContents"><a name="156"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="157" onclick="window.location.hash='#157'"></td><td class="FileContents-lineContents"><a name="157"></a><span class="str">  Args:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="158" onclick="window.location.hash='#158'"></td><td class="FileContents-lineContents"><a name="158"></a><span class="str">    eval_data: bool, indicating if one should use the train or eval data set.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="159" onclick="window.location.hash='#159'"></td><td class="FileContents-lineContents"><a name="159"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="160" onclick="window.location.hash='#160'"></td><td class="FileContents-lineContents"><a name="160"></a><span class="str">  Returns:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="161" onclick="window.location.hash='#161'"></td><td class="FileContents-lineContents"><a name="161"></a><span class="str">    images: Images. 4D tensor of [batch_size, IMAGE_SIZE, IMAGE_SIZE, 3] size.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="162" onclick="window.location.hash='#162'"></td><td class="FileContents-lineContents"><a name="162"></a><span class="str">    labels: Labels. 1D tensor of [batch_size] size.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="163" onclick="window.location.hash='#163'"></td><td class="FileContents-lineContents"><a name="163"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="164" onclick="window.location.hash='#164'"></td><td class="FileContents-lineContents"><a name="164"></a><span class="str">  Raises:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="165" onclick="window.location.hash='#165'"></td><td class="FileContents-lineContents"><a name="165"></a><span class="str">    ValueError: If no data_dir</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="166" onclick="window.location.hash='#166'"></td><td class="FileContents-lineContents"><a name="166"></a><span class="str">  &quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="167" onclick="window.location.hash='#167'"></td><td class="FileContents-lineContents"><a name="167"></a><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> FLAGS</span><span class="pun">.</span><span class="pln">data_dir</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="168" onclick="window.location.hash='#168'"></td><td class="FileContents-lineContents"><a name="168"></a><span class="pln">    </span><span class="kwd">raise</span><span class="pln"> </span><span class="typ">ValueError</span><span class="pun">(</span><span class="str">&#39;Please supply a data_dir&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="169" onclick="window.location.hash='#169'"></td><td class="FileContents-lineContents"><a name="169"></a><span class="pln">  data_dir </span><span class="pun">=</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">FLAGS</span><span class="pun">.</span><span class="pln">data_dir</span><span class="pun">,</span><span class="pln"> </span><span class="str">&#39;cifar-10-batches-bin&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="170" onclick="window.location.hash='#170'"></td><td class="FileContents-lineContents"><a name="170"></a><span class="pln">  </span><span class="kwd">return</span><span class="pln"> cifar10_input</span><span class="pun">.</span><span class="pln">inputs</span><span class="pun">(</span><span class="pln">eval_data</span><span class="pun">=</span><span class="pln">eval_data</span><span class="pun">,</span><span class="pln"> data_dir</span><span class="pun">=</span><span class="pln">data_dir</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="171" onclick="window.location.hash='#171'"></td><td class="FileContents-lineContents"><a name="171"></a><span class="pln">                              batch_size</span><span class="pun">=</span><span class="pln">FLAGS</span><span class="pun">.</span><span class="pln">batch_size</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="172" onclick="window.location.hash='#172'"></td><td class="FileContents-lineContents"><a name="172"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="173" onclick="window.location.hash='#173'"></td><td class="FileContents-lineContents"><a name="173"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="174" onclick="window.location.hash='#174'"></td><td class="FileContents-lineContents"><a name="174"></a><span class="kwd">def</span><span class="pln"> inference</span><span class="pun">(</span><span class="pln">images</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="175" onclick="window.location.hash='#175'"></td><td class="FileContents-lineContents"><a name="175"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Build the CIFAR-10 model.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="176" onclick="window.location.hash='#176'"></td><td class="FileContents-lineContents"><a name="176"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="177" onclick="window.location.hash='#177'"></td><td class="FileContents-lineContents"><a name="177"></a><span class="str">  Args:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="178" onclick="window.location.hash='#178'"></td><td class="FileContents-lineContents"><a name="178"></a><span class="str">    images: Images returned from distorted_inputs() or inputs().</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="179" onclick="window.location.hash='#179'"></td><td class="FileContents-lineContents"><a name="179"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="180" onclick="window.location.hash='#180'"></td><td class="FileContents-lineContents"><a name="180"></a><span class="str">  Returns:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="181" onclick="window.location.hash='#181'"></td><td class="FileContents-lineContents"><a name="181"></a><span class="str">    Logits.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="182" onclick="window.location.hash='#182'"></td><td class="FileContents-lineContents"><a name="182"></a><span class="str">  &quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="183" onclick="window.location.hash='#183'"></td><td class="FileContents-lineContents"><a name="183"></a><span class="pln">  </span><span class="com"># We instantiate all variables using tf.get_variable() instead of</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="184" onclick="window.location.hash='#184'"></td><td class="FileContents-lineContents"><a name="184"></a><span class="pln">  </span><span class="com"># tf.Variable() in order to share variables across multiple GPU training runs.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="185" onclick="window.location.hash='#185'"></td><td class="FileContents-lineContents"><a name="185"></a><span class="pln">  </span><span class="com"># If we only ran this model on a single GPU, we could simplify this function</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="186" onclick="window.location.hash='#186'"></td><td class="FileContents-lineContents"><a name="186"></a><span class="pln">  </span><span class="com"># by replacing all instances of tf.get_variable() with tf.Variable().</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="187" onclick="window.location.hash='#187'"></td><td class="FileContents-lineContents"><a name="187"></a><span class="pln">  </span><span class="com">#</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="188" onclick="window.location.hash='#188'"></td><td class="FileContents-lineContents"><a name="188"></a><span class="pln">  </span><span class="com"># conv1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="189" onclick="window.location.hash='#189'"></td><td class="FileContents-lineContents"><a name="189"></a><span class="pln">  </span><span class="kwd">with</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">variable_scope</span><span class="pun">(</span><span class="str">&#39;conv1&#39;</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> scope</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="190" onclick="window.location.hash='#190'"></td><td class="FileContents-lineContents"><a name="190"></a><span class="pln">    kernel </span><span class="pun">=</span><span class="pln"> _variable_with_weight_decay</span><span class="pun">(</span><span class="str">&#39;weights&#39;</span><span class="pun">,</span><span class="pln"> shape</span><span class="pun">=[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">64</span><span class="pun">],</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="191" onclick="window.location.hash='#191'"></td><td class="FileContents-lineContents"><a name="191"></a><span class="pln">                                         stddev</span><span class="pun">=</span><span class="lit">1e-4</span><span class="pun">,</span><span class="pln"> wd</span><span class="pun">=</span><span class="lit">0.0</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="192" onclick="window.location.hash='#192'"></td><td class="FileContents-lineContents"><a name="192"></a><span class="pln">    conv </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">conv2d</span><span class="pun">(</span><span class="pln">images</span><span class="pun">,</span><span class="pln"> kernel</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> padding</span><span class="pun">=</span><span class="str">&#39;SAME&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="193" onclick="window.location.hash='#193'"></td><td class="FileContents-lineContents"><a name="193"></a><span class="pln">    biases </span><span class="pun">=</span><span class="pln"> _variable_on_cpu</span><span class="pun">(</span><span class="str">&#39;biases&#39;</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">64</span><span class="pun">],</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">constant_initializer</span><span class="pun">(</span><span class="lit">0.0</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="194" onclick="window.location.hash='#194'"></td><td class="FileContents-lineContents"><a name="194"></a><span class="pln">    bias </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">bias_add</span><span class="pun">(</span><span class="pln">conv</span><span class="pun">,</span><span class="pln"> biases</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="195" onclick="window.location.hash='#195'"></td><td class="FileContents-lineContents"><a name="195"></a><span class="pln">    conv1 </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">relu</span><span class="pun">(</span><span class="pln">bias</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="196" onclick="window.location.hash='#196'"></td><td class="FileContents-lineContents"><a name="196"></a><span class="pln">    _activation_summary</span><span class="pun">(</span><span class="pln">conv1</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="197" onclick="window.location.hash='#197'"></td><td class="FileContents-lineContents"><a name="197"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="198" onclick="window.location.hash='#198'"></td><td class="FileContents-lineContents"><a name="198"></a><span class="pln">  </span><span class="com"># pool1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="199" onclick="window.location.hash='#199'"></td><td class="FileContents-lineContents"><a name="199"></a><span class="pln">  pool1 </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">max_pool</span><span class="pun">(</span><span class="pln">conv1</span><span class="pun">,</span><span class="pln"> ksize</span><span class="pun">=[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> strides</span><span class="pun">=[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="200" onclick="window.location.hash='#200'"></td><td class="FileContents-lineContents"><a name="200"></a><span class="pln">                         padding</span><span class="pun">=</span><span class="str">&#39;SAME&#39;</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="str">&#39;pool1&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="201" onclick="window.location.hash='#201'"></td><td class="FileContents-lineContents"><a name="201"></a><span class="pln">  </span><span class="com"># norm1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="202" onclick="window.location.hash='#202'"></td><td class="FileContents-lineContents"><a name="202"></a><span class="pln">  norm1 </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">lrn</span><span class="pun">(</span><span class="pln">pool1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> bias</span><span class="pun">=</span><span class="lit">1.0</span><span class="pun">,</span><span class="pln"> alpha</span><span class="pun">=</span><span class="lit">0.001</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">9.0</span><span class="pun">,</span><span class="pln"> beta</span><span class="pun">=</span><span class="lit">0.75</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="203" onclick="window.location.hash='#203'"></td><td class="FileContents-lineContents"><a name="203"></a><span class="pln">                    name</span><span class="pun">=</span><span class="str">&#39;norm1&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="204" onclick="window.location.hash='#204'"></td><td class="FileContents-lineContents"><a name="204"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="205" onclick="window.location.hash='#205'"></td><td class="FileContents-lineContents"><a name="205"></a><span class="pln">  </span><span class="com"># conv2</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="206" onclick="window.location.hash='#206'"></td><td class="FileContents-lineContents"><a name="206"></a><span class="pln">  </span><span class="kwd">with</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">variable_scope</span><span class="pun">(</span><span class="str">&#39;conv2&#39;</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> scope</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="207" onclick="window.location.hash='#207'"></td><td class="FileContents-lineContents"><a name="207"></a><span class="pln">    kernel </span><span class="pun">=</span><span class="pln"> _variable_with_weight_decay</span><span class="pun">(</span><span class="str">&#39;weights&#39;</span><span class="pun">,</span><span class="pln"> shape</span><span class="pun">=[</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">64</span><span class="pun">,</span><span class="pln"> </span><span class="lit">64</span><span class="pun">],</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="208" onclick="window.location.hash='#208'"></td><td class="FileContents-lineContents"><a name="208"></a><span class="pln">                                         stddev</span><span class="pun">=</span><span class="lit">1e-4</span><span class="pun">,</span><span class="pln"> wd</span><span class="pun">=</span><span class="lit">0.0</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="209" onclick="window.location.hash='#209'"></td><td class="FileContents-lineContents"><a name="209"></a><span class="pln">    conv </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">conv2d</span><span class="pun">(</span><span class="pln">norm1</span><span class="pun">,</span><span class="pln"> kernel</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> padding</span><span class="pun">=</span><span class="str">&#39;SAME&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="210" onclick="window.location.hash='#210'"></td><td class="FileContents-lineContents"><a name="210"></a><span class="pln">    biases </span><span class="pun">=</span><span class="pln"> _variable_on_cpu</span><span class="pun">(</span><span class="str">&#39;biases&#39;</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">64</span><span class="pun">],</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">constant_initializer</span><span class="pun">(</span><span class="lit">0.1</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="211" onclick="window.location.hash='#211'"></td><td class="FileContents-lineContents"><a name="211"></a><span class="pln">    bias </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">bias_add</span><span class="pun">(</span><span class="pln">conv</span><span class="pun">,</span><span class="pln"> biases</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="212" onclick="window.location.hash='#212'"></td><td class="FileContents-lineContents"><a name="212"></a><span class="pln">    conv2 </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">relu</span><span class="pun">(</span><span class="pln">bias</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="213" onclick="window.location.hash='#213'"></td><td class="FileContents-lineContents"><a name="213"></a><span class="pln">    _activation_summary</span><span class="pun">(</span><span class="pln">conv2</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="214" onclick="window.location.hash='#214'"></td><td class="FileContents-lineContents"><a name="214"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="215" onclick="window.location.hash='#215'"></td><td class="FileContents-lineContents"><a name="215"></a><span class="pln">  </span><span class="com"># norm2</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="216" onclick="window.location.hash='#216'"></td><td class="FileContents-lineContents"><a name="216"></a><span class="pln">  norm2 </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">lrn</span><span class="pun">(</span><span class="pln">conv2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">4</span><span class="pun">,</span><span class="pln"> bias</span><span class="pun">=</span><span class="lit">1.0</span><span class="pun">,</span><span class="pln"> alpha</span><span class="pun">=</span><span class="lit">0.001</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> </span><span class="lit">9.0</span><span class="pun">,</span><span class="pln"> beta</span><span class="pun">=</span><span class="lit">0.75</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="217" onclick="window.location.hash='#217'"></td><td class="FileContents-lineContents"><a name="217"></a><span class="pln">                    name</span><span class="pun">=</span><span class="str">&#39;norm2&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="218" onclick="window.location.hash='#218'"></td><td class="FileContents-lineContents"><a name="218"></a><span class="pln">  </span><span class="com"># pool2</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="219" onclick="window.location.hash='#219'"></td><td class="FileContents-lineContents"><a name="219"></a><span class="pln">  pool2 </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">max_pool</span><span class="pun">(</span><span class="pln">norm2</span><span class="pun">,</span><span class="pln"> ksize</span><span class="pun">=[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="220" onclick="window.location.hash='#220'"></td><td class="FileContents-lineContents"><a name="220"></a><span class="pln">                         strides</span><span class="pun">=[</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">],</span><span class="pln"> padding</span><span class="pun">=</span><span class="str">&#39;SAME&#39;</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="str">&#39;pool2&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="221" onclick="window.location.hash='#221'"></td><td class="FileContents-lineContents"><a name="221"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="222" onclick="window.location.hash='#222'"></td><td class="FileContents-lineContents"><a name="222"></a><span class="pln">  </span><span class="com"># local3</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="223" onclick="window.location.hash='#223'"></td><td class="FileContents-lineContents"><a name="223"></a><span class="pln">  </span><span class="kwd">with</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">variable_scope</span><span class="pun">(</span><span class="str">&#39;local3&#39;</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> scope</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="224" onclick="window.location.hash='#224'"></td><td class="FileContents-lineContents"><a name="224"></a><span class="pln">    </span><span class="com"># Move everything into depth so we can perform a single matrix multiply.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="225" onclick="window.location.hash='#225'"></td><td class="FileContents-lineContents"><a name="225"></a><span class="pln">    dim </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="226" onclick="window.location.hash='#226'"></td><td class="FileContents-lineContents"><a name="226"></a><span class="pln">    </span><span class="kwd">for</span><span class="pln"> d </span><span class="kwd">in</span><span class="pln"> pool2</span><span class="pun">.</span><span class="pln">get_shape</span><span class="pun">()[</span><span class="lit">1</span><span class="pun">:].</span><span class="pln">as_list</span><span class="pun">():</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="227" onclick="window.location.hash='#227'"></td><td class="FileContents-lineContents"><a name="227"></a><span class="pln">      dim </span><span class="pun">*=</span><span class="pln"> d</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="228" onclick="window.location.hash='#228'"></td><td class="FileContents-lineContents"><a name="228"></a><span class="pln">    reshape </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">reshape</span><span class="pun">(</span><span class="pln">pool2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">FLAGS</span><span class="pun">.</span><span class="pln">batch_size</span><span class="pun">,</span><span class="pln"> dim</span><span class="pun">])</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="229" onclick="window.location.hash='#229'"></td><td class="FileContents-lineContents"><a name="229"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="230" onclick="window.location.hash='#230'"></td><td class="FileContents-lineContents"><a name="230"></a><span class="pln">    weights </span><span class="pun">=</span><span class="pln"> _variable_with_weight_decay</span><span class="pun">(</span><span class="str">&#39;weights&#39;</span><span class="pun">,</span><span class="pln"> shape</span><span class="pun">=[</span><span class="pln">dim</span><span class="pun">,</span><span class="pln"> </span><span class="lit">384</span><span class="pun">],</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="231" onclick="window.location.hash='#231'"></td><td class="FileContents-lineContents"><a name="231"></a><span class="pln">                                          stddev</span><span class="pun">=</span><span class="lit">0.04</span><span class="pun">,</span><span class="pln"> wd</span><span class="pun">=</span><span class="lit">0.004</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="232" onclick="window.location.hash='#232'"></td><td class="FileContents-lineContents"><a name="232"></a><span class="pln">    biases </span><span class="pun">=</span><span class="pln"> _variable_on_cpu</span><span class="pun">(</span><span class="str">&#39;biases&#39;</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">384</span><span class="pun">],</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">constant_initializer</span><span class="pun">(</span><span class="lit">0.1</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="233" onclick="window.location.hash='#233'"></td><td class="FileContents-lineContents"><a name="233"></a><span class="pln">    local3 </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">relu</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">matmul</span><span class="pun">(</span><span class="pln">reshape</span><span class="pun">,</span><span class="pln"> weights</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> biases</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="234" onclick="window.location.hash='#234'"></td><td class="FileContents-lineContents"><a name="234"></a><span class="pln">    _activation_summary</span><span class="pun">(</span><span class="pln">local3</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="235" onclick="window.location.hash='#235'"></td><td class="FileContents-lineContents"><a name="235"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="236" onclick="window.location.hash='#236'"></td><td class="FileContents-lineContents"><a name="236"></a><span class="pln">  </span><span class="com"># local4</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="237" onclick="window.location.hash='#237'"></td><td class="FileContents-lineContents"><a name="237"></a><span class="pln">  </span><span class="kwd">with</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">variable_scope</span><span class="pun">(</span><span class="str">&#39;local4&#39;</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> scope</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="238" onclick="window.location.hash='#238'"></td><td class="FileContents-lineContents"><a name="238"></a><span class="pln">    weights </span><span class="pun">=</span><span class="pln"> _variable_with_weight_decay</span><span class="pun">(</span><span class="str">&#39;weights&#39;</span><span class="pun">,</span><span class="pln"> shape</span><span class="pun">=[</span><span class="lit">384</span><span class="pun">,</span><span class="pln"> </span><span class="lit">192</span><span class="pun">],</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="239" onclick="window.location.hash='#239'"></td><td class="FileContents-lineContents"><a name="239"></a><span class="pln">                                          stddev</span><span class="pun">=</span><span class="lit">0.04</span><span class="pun">,</span><span class="pln"> wd</span><span class="pun">=</span><span class="lit">0.004</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="240" onclick="window.location.hash='#240'"></td><td class="FileContents-lineContents"><a name="240"></a><span class="pln">    biases </span><span class="pun">=</span><span class="pln"> _variable_on_cpu</span><span class="pun">(</span><span class="str">&#39;biases&#39;</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">192</span><span class="pun">],</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">constant_initializer</span><span class="pun">(</span><span class="lit">0.1</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="241" onclick="window.location.hash='#241'"></td><td class="FileContents-lineContents"><a name="241"></a><span class="pln">    local4 </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">relu</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">matmul</span><span class="pun">(</span><span class="pln">local3</span><span class="pun">,</span><span class="pln"> weights</span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> biases</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="242" onclick="window.location.hash='#242'"></td><td class="FileContents-lineContents"><a name="242"></a><span class="pln">    _activation_summary</span><span class="pun">(</span><span class="pln">local4</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="243" onclick="window.location.hash='#243'"></td><td class="FileContents-lineContents"><a name="243"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="244" onclick="window.location.hash='#244'"></td><td class="FileContents-lineContents"><a name="244"></a><span class="pln">  </span><span class="com"># softmax, i.e. softmax(WX + b)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="245" onclick="window.location.hash='#245'"></td><td class="FileContents-lineContents"><a name="245"></a><span class="pln">  </span><span class="kwd">with</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">variable_scope</span><span class="pun">(</span><span class="str">&#39;softmax_linear&#39;</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">as</span><span class="pln"> scope</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="246" onclick="window.location.hash='#246'"></td><td class="FileContents-lineContents"><a name="246"></a><span class="pln">    weights </span><span class="pun">=</span><span class="pln"> _variable_with_weight_decay</span><span class="pun">(</span><span class="str">&#39;weights&#39;</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="lit">192</span><span class="pun">,</span><span class="pln"> NUM_CLASSES</span><span class="pun">],</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="247" onclick="window.location.hash='#247'"></td><td class="FileContents-lineContents"><a name="247"></a><span class="pln">                                          stddev</span><span class="pun">=</span><span class="lit">1</span><span class="pun">/</span><span class="lit">192.0</span><span class="pun">,</span><span class="pln"> wd</span><span class="pun">=</span><span class="lit">0.0</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="248" onclick="window.location.hash='#248'"></td><td class="FileContents-lineContents"><a name="248"></a><span class="pln">    biases </span><span class="pun">=</span><span class="pln"> _variable_on_cpu</span><span class="pun">(</span><span class="str">&#39;biases&#39;</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">NUM_CLASSES</span><span class="pun">],</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="249" onclick="window.location.hash='#249'"></td><td class="FileContents-lineContents"><a name="249"></a><span class="pln">                              tf</span><span class="pun">.</span><span class="pln">constant_initializer</span><span class="pun">(</span><span class="lit">0.0</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="250" onclick="window.location.hash='#250'"></td><td class="FileContents-lineContents"><a name="250"></a><span class="pln">    softmax_linear </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">matmul</span><span class="pun">(</span><span class="pln">local4</span><span class="pun">,</span><span class="pln"> weights</span><span class="pun">),</span><span class="pln"> biases</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="pln">scope</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="251" onclick="window.location.hash='#251'"></td><td class="FileContents-lineContents"><a name="251"></a><span class="pln">    _activation_summary</span><span class="pun">(</span><span class="pln">softmax_linear</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="252" onclick="window.location.hash='#252'"></td><td class="FileContents-lineContents"><a name="252"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="253" onclick="window.location.hash='#253'"></td><td class="FileContents-lineContents"><a name="253"></a><span class="pln">  </span><span class="kwd">return</span><span class="pln"> softmax_linear</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="254" onclick="window.location.hash='#254'"></td><td class="FileContents-lineContents"><a name="254"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="255" onclick="window.location.hash='#255'"></td><td class="FileContents-lineContents"><a name="255"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="256" onclick="window.location.hash='#256'"></td><td class="FileContents-lineContents"><a name="256"></a><span class="kwd">def</span><span class="pln"> loss</span><span class="pun">(</span><span class="pln">logits</span><span class="pun">,</span><span class="pln"> labels</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="257" onclick="window.location.hash='#257'"></td><td class="FileContents-lineContents"><a name="257"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Add L2Loss to all the trainable variables.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="258" onclick="window.location.hash='#258'"></td><td class="FileContents-lineContents"><a name="258"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="259" onclick="window.location.hash='#259'"></td><td class="FileContents-lineContents"><a name="259"></a><span class="str">  Add summary for for &quot;Loss&quot; and &quot;Loss/avg&quot;.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="260" onclick="window.location.hash='#260'"></td><td class="FileContents-lineContents"><a name="260"></a><span class="str">  Args:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="261" onclick="window.location.hash='#261'"></td><td class="FileContents-lineContents"><a name="261"></a><span class="str">    logits: Logits from inference().</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="262" onclick="window.location.hash='#262'"></td><td class="FileContents-lineContents"><a name="262"></a><span class="str">    labels: Labels from distorted_inputs or inputs(). 1-D tensor</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="263" onclick="window.location.hash='#263'"></td><td class="FileContents-lineContents"><a name="263"></a><span class="str">            of shape [batch_size]</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="264" onclick="window.location.hash='#264'"></td><td class="FileContents-lineContents"><a name="264"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="265" onclick="window.location.hash='#265'"></td><td class="FileContents-lineContents"><a name="265"></a><span class="str">  Returns:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="266" onclick="window.location.hash='#266'"></td><td class="FileContents-lineContents"><a name="266"></a><span class="str">    Loss tensor of type float.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="267" onclick="window.location.hash='#267'"></td><td class="FileContents-lineContents"><a name="267"></a><span class="str">  &quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="268" onclick="window.location.hash='#268'"></td><td class="FileContents-lineContents"><a name="268"></a><span class="pln">  </span><span class="com"># Reshape the labels into a dense Tensor of</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="269" onclick="window.location.hash='#269'"></td><td class="FileContents-lineContents"><a name="269"></a><span class="pln">  </span><span class="com"># shape [batch_size, NUM_CLASSES].</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="270" onclick="window.location.hash='#270'"></td><td class="FileContents-lineContents"><a name="270"></a><span class="pln">  sparse_labels </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">reshape</span><span class="pun">(</span><span class="pln">labels</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">FLAGS</span><span class="pun">.</span><span class="pln">batch_size</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">])</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="271" onclick="window.location.hash='#271'"></td><td class="FileContents-lineContents"><a name="271"></a><span class="pln">  indices </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">reshape</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">range</span><span class="pun">(</span><span class="pln">FLAGS</span><span class="pun">.</span><span class="pln">batch_size</span><span class="pun">),</span><span class="pln"> </span><span class="pun">[</span><span class="pln">FLAGS</span><span class="pun">.</span><span class="pln">batch_size</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">])</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="272" onclick="window.location.hash='#272'"></td><td class="FileContents-lineContents"><a name="272"></a><span class="pln">  concated </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">concat</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">indices</span><span class="pun">,</span><span class="pln"> sparse_labels</span><span class="pun">])</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="273" onclick="window.location.hash='#273'"></td><td class="FileContents-lineContents"><a name="273"></a><span class="pln">  dense_labels </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">sparse_to_dense</span><span class="pun">(</span><span class="pln">concated</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="274" onclick="window.location.hash='#274'"></td><td class="FileContents-lineContents"><a name="274"></a><span class="pln">                                    </span><span class="pun">[</span><span class="pln">FLAGS</span><span class="pun">.</span><span class="pln">batch_size</span><span class="pun">,</span><span class="pln"> NUM_CLASSES</span><span class="pun">],</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="275" onclick="window.location.hash='#275'"></td><td class="FileContents-lineContents"><a name="275"></a><span class="pln">                                    </span><span class="lit">1.0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.0</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="276" onclick="window.location.hash='#276'"></td><td class="FileContents-lineContents"><a name="276"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="277" onclick="window.location.hash='#277'"></td><td class="FileContents-lineContents"><a name="277"></a><span class="pln">  </span><span class="com"># Calculate the average cross entropy loss across the batch.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="278" onclick="window.location.hash='#278'"></td><td class="FileContents-lineContents"><a name="278"></a><span class="pln">  cross_entropy </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">nn</span><span class="pun">.</span><span class="pln">softmax_cross_entropy_with_logits</span><span class="pun">(</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="279" onclick="window.location.hash='#279'"></td><td class="FileContents-lineContents"><a name="279"></a><span class="pln">      logits</span><span class="pun">,</span><span class="pln"> dense_labels</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="str">&#39;cross_entropy_per_example&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="280" onclick="window.location.hash='#280'"></td><td class="FileContents-lineContents"><a name="280"></a><span class="pln">  cross_entropy_mean </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">reduce_mean</span><span class="pun">(</span><span class="pln">cross_entropy</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="str">&#39;cross_entropy&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="281" onclick="window.location.hash='#281'"></td><td class="FileContents-lineContents"><a name="281"></a><span class="pln">  tf</span><span class="pun">.</span><span class="pln">add_to_collection</span><span class="pun">(</span><span class="str">&#39;losses&#39;</span><span class="pun">,</span><span class="pln"> cross_entropy_mean</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="282" onclick="window.location.hash='#282'"></td><td class="FileContents-lineContents"><a name="282"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="283" onclick="window.location.hash='#283'"></td><td class="FileContents-lineContents"><a name="283"></a><span class="pln">  </span><span class="com"># The total loss is defined as the cross entropy loss plus all of the weight</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="284" onclick="window.location.hash='#284'"></td><td class="FileContents-lineContents"><a name="284"></a><span class="pln">  </span><span class="com"># decay terms (L2 loss).</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="285" onclick="window.location.hash='#285'"></td><td class="FileContents-lineContents"><a name="285"></a><span class="pln">  </span><span class="kwd">return</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">add_n</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">get_collection</span><span class="pun">(</span><span class="str">&#39;losses&#39;</span><span class="pun">),</span><span class="pln"> name</span><span class="pun">=</span><span class="str">&#39;total_loss&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="286" onclick="window.location.hash='#286'"></td><td class="FileContents-lineContents"><a name="286"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="287" onclick="window.location.hash='#287'"></td><td class="FileContents-lineContents"><a name="287"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="288" onclick="window.location.hash='#288'"></td><td class="FileContents-lineContents"><a name="288"></a><span class="kwd">def</span><span class="pln"> _add_loss_summaries</span><span class="pun">(</span><span class="pln">total_loss</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="289" onclick="window.location.hash='#289'"></td><td class="FileContents-lineContents"><a name="289"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Add summaries for losses in CIFAR-10 model.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="290" onclick="window.location.hash='#290'"></td><td class="FileContents-lineContents"><a name="290"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="291" onclick="window.location.hash='#291'"></td><td class="FileContents-lineContents"><a name="291"></a><span class="str">  Generates moving average for all losses and associated summaries for</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="292" onclick="window.location.hash='#292'"></td><td class="FileContents-lineContents"><a name="292"></a><span class="str">  visualizing the performance of the network.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="293" onclick="window.location.hash='#293'"></td><td class="FileContents-lineContents"><a name="293"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="294" onclick="window.location.hash='#294'"></td><td class="FileContents-lineContents"><a name="294"></a><span class="str">  Args:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="295" onclick="window.location.hash='#295'"></td><td class="FileContents-lineContents"><a name="295"></a><span class="str">    total_loss: Total loss from loss().</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="296" onclick="window.location.hash='#296'"></td><td class="FileContents-lineContents"><a name="296"></a><span class="str">  Returns:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="297" onclick="window.location.hash='#297'"></td><td class="FileContents-lineContents"><a name="297"></a><span class="str">    loss_averages_op: op for generating moving averages of losses.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="298" onclick="window.location.hash='#298'"></td><td class="FileContents-lineContents"><a name="298"></a><span class="str">  &quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="299" onclick="window.location.hash='#299'"></td><td class="FileContents-lineContents"><a name="299"></a><span class="pln">  </span><span class="com"># Compute the moving average of all individual losses and the total loss.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="300" onclick="window.location.hash='#300'"></td><td class="FileContents-lineContents"><a name="300"></a><span class="pln">  loss_averages </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">train</span><span class="pun">.</span><span class="typ">ExponentialMovingAverage</span><span class="pun">(</span><span class="lit">0.9</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">=</span><span class="str">&#39;avg&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="301" onclick="window.location.hash='#301'"></td><td class="FileContents-lineContents"><a name="301"></a><span class="pln">  losses </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">get_collection</span><span class="pun">(</span><span class="str">&#39;losses&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="302" onclick="window.location.hash='#302'"></td><td class="FileContents-lineContents"><a name="302"></a><span class="pln">  loss_averages_op </span><span class="pun">=</span><span class="pln"> loss_averages</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="pln">losses </span><span class="pun">+</span><span class="pln"> </span><span class="pun">[</span><span class="pln">total_loss</span><span class="pun">])</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="303" onclick="window.location.hash='#303'"></td><td class="FileContents-lineContents"><a name="303"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="304" onclick="window.location.hash='#304'"></td><td class="FileContents-lineContents"><a name="304"></a><span class="pln">  </span><span class="com"># Attach a scalar summary to all individual losses and the total loss; do the</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="305" onclick="window.location.hash='#305'"></td><td class="FileContents-lineContents"><a name="305"></a><span class="pln">  </span><span class="com"># same for the averaged version of the losses.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="306" onclick="window.location.hash='#306'"></td><td class="FileContents-lineContents"><a name="306"></a><span class="pln">  </span><span class="kwd">for</span><span class="pln"> l </span><span class="kwd">in</span><span class="pln"> losses </span><span class="pun">+</span><span class="pln"> </span><span class="pun">[</span><span class="pln">total_loss</span><span class="pun">]:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="307" onclick="window.location.hash='#307'"></td><td class="FileContents-lineContents"><a name="307"></a><span class="pln">    </span><span class="com"># Name each loss as &#39;(raw)&#39; and name the moving average version of the loss</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="308" onclick="window.location.hash='#308'"></td><td class="FileContents-lineContents"><a name="308"></a><span class="pln">    </span><span class="com"># as the original loss name.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="309" onclick="window.location.hash='#309'"></td><td class="FileContents-lineContents"><a name="309"></a><span class="pln">    tf</span><span class="pun">.</span><span class="pln">scalar_summary</span><span class="pun">(</span><span class="pln">l</span><span class="pun">.</span><span class="pln">op</span><span class="pun">.</span><span class="pln">name </span><span class="pun">+</span><span class="str">&#39; (raw)&#39;</span><span class="pun">,</span><span class="pln"> l</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="310" onclick="window.location.hash='#310'"></td><td class="FileContents-lineContents"><a name="310"></a><span class="pln">    tf</span><span class="pun">.</span><span class="pln">scalar_summary</span><span class="pun">(</span><span class="pln">l</span><span class="pun">.</span><span class="pln">op</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> loss_averages</span><span class="pun">.</span><span class="pln">average</span><span class="pun">(</span><span class="pln">l</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="311" onclick="window.location.hash='#311'"></td><td class="FileContents-lineContents"><a name="311"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="312" onclick="window.location.hash='#312'"></td><td class="FileContents-lineContents"><a name="312"></a><span class="pln">  </span><span class="kwd">return</span><span class="pln"> loss_averages_op</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="313" onclick="window.location.hash='#313'"></td><td class="FileContents-lineContents"><a name="313"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="314" onclick="window.location.hash='#314'"></td><td class="FileContents-lineContents"><a name="314"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="315" onclick="window.location.hash='#315'"></td><td class="FileContents-lineContents"><a name="315"></a><span class="kwd">def</span><span class="pln"> train</span><span class="pun">(</span><span class="pln">total_loss</span><span class="pun">,</span><span class="pln"> global_step</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="316" onclick="window.location.hash='#316'"></td><td class="FileContents-lineContents"><a name="316"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Train CIFAR-10 model.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="317" onclick="window.location.hash='#317'"></td><td class="FileContents-lineContents"><a name="317"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="318" onclick="window.location.hash='#318'"></td><td class="FileContents-lineContents"><a name="318"></a><span class="str">  Create an optimizer and apply to all trainable variables. Add moving</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="319" onclick="window.location.hash='#319'"></td><td class="FileContents-lineContents"><a name="319"></a><span class="str">  average for all trainable variables.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="320" onclick="window.location.hash='#320'"></td><td class="FileContents-lineContents"><a name="320"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="321" onclick="window.location.hash='#321'"></td><td class="FileContents-lineContents"><a name="321"></a><span class="str">  Args:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="322" onclick="window.location.hash='#322'"></td><td class="FileContents-lineContents"><a name="322"></a><span class="str">    total_loss: Total loss from loss().</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="323" onclick="window.location.hash='#323'"></td><td class="FileContents-lineContents"><a name="323"></a><span class="str">    global_step: Integer Variable counting the number of training steps</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="324" onclick="window.location.hash='#324'"></td><td class="FileContents-lineContents"><a name="324"></a><span class="str">      processed.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="325" onclick="window.location.hash='#325'"></td><td class="FileContents-lineContents"><a name="325"></a><span class="str">  Returns:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="326" onclick="window.location.hash='#326'"></td><td class="FileContents-lineContents"><a name="326"></a><span class="str">    train_op: op for training.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="327" onclick="window.location.hash='#327'"></td><td class="FileContents-lineContents"><a name="327"></a><span class="str">  &quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="328" onclick="window.location.hash='#328'"></td><td class="FileContents-lineContents"><a name="328"></a><span class="pln">  </span><span class="com"># Variables that affect learning rate.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="329" onclick="window.location.hash='#329'"></td><td class="FileContents-lineContents"><a name="329"></a><span class="pln">  num_batches_per_epoch </span><span class="pun">=</span><span class="pln"> NUM_EXAMPLES_PER_EPOCH_FOR_TRAIN </span><span class="pun">/</span><span class="pln"> FLAGS</span><span class="pun">.</span><span class="pln">batch_size</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="330" onclick="window.location.hash='#330'"></td><td class="FileContents-lineContents"><a name="330"></a><span class="pln">  decay_steps </span><span class="pun">=</span><span class="pln"> int</span><span class="pun">(</span><span class="pln">num_batches_per_epoch </span><span class="pun">*</span><span class="pln"> NUM_EPOCHS_PER_DECAY</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="331" onclick="window.location.hash='#331'"></td><td class="FileContents-lineContents"><a name="331"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="332" onclick="window.location.hash='#332'"></td><td class="FileContents-lineContents"><a name="332"></a><span class="pln">  </span><span class="com"># Decay the learning rate exponentially based on the number of steps.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="333" onclick="window.location.hash='#333'"></td><td class="FileContents-lineContents"><a name="333"></a><span class="pln">  lr </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">train</span><span class="pun">.</span><span class="pln">exponential_decay</span><span class="pun">(</span><span class="pln">INITIAL_LEARNING_RATE</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="334" onclick="window.location.hash='#334'"></td><td class="FileContents-lineContents"><a name="334"></a><span class="pln">                                  global_step</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="335" onclick="window.location.hash='#335'"></td><td class="FileContents-lineContents"><a name="335"></a><span class="pln">                                  decay_steps</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="336" onclick="window.location.hash='#336'"></td><td class="FileContents-lineContents"><a name="336"></a><span class="pln">                                  LEARNING_RATE_DECAY_FACTOR</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="337" onclick="window.location.hash='#337'"></td><td class="FileContents-lineContents"><a name="337"></a><span class="pln">                                  staircase</span><span class="pun">=</span><span class="kwd">True</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="338" onclick="window.location.hash='#338'"></td><td class="FileContents-lineContents"><a name="338"></a><span class="pln">  tf</span><span class="pun">.</span><span class="pln">scalar_summary</span><span class="pun">(</span><span class="str">&#39;learning_rate&#39;</span><span class="pun">,</span><span class="pln"> lr</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="339" onclick="window.location.hash='#339'"></td><td class="FileContents-lineContents"><a name="339"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="340" onclick="window.location.hash='#340'"></td><td class="FileContents-lineContents"><a name="340"></a><span class="pln">  </span><span class="com"># Generate moving averages of all losses and associated summaries.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="341" onclick="window.location.hash='#341'"></td><td class="FileContents-lineContents"><a name="341"></a><span class="pln">  loss_averages_op </span><span class="pun">=</span><span class="pln"> _add_loss_summaries</span><span class="pun">(</span><span class="pln">total_loss</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="342" onclick="window.location.hash='#342'"></td><td class="FileContents-lineContents"><a name="342"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="343" onclick="window.location.hash='#343'"></td><td class="FileContents-lineContents"><a name="343"></a><span class="pln">  </span><span class="com"># Compute gradients.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="344" onclick="window.location.hash='#344'"></td><td class="FileContents-lineContents"><a name="344"></a><span class="pln">  </span><span class="kwd">with</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">control_dependencies</span><span class="pun">([</span><span class="pln">loss_averages_op</span><span class="pun">]):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="345" onclick="window.location.hash='#345'"></td><td class="FileContents-lineContents"><a name="345"></a><span class="pln">    opt </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">train</span><span class="pun">.</span><span class="typ">GradientDescentOptimizer</span><span class="pun">(</span><span class="pln">lr</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="346" onclick="window.location.hash='#346'"></td><td class="FileContents-lineContents"><a name="346"></a><span class="pln">    grads </span><span class="pun">=</span><span class="pln"> opt</span><span class="pun">.</span><span class="pln">compute_gradients</span><span class="pun">(</span><span class="pln">total_loss</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="347" onclick="window.location.hash='#347'"></td><td class="FileContents-lineContents"><a name="347"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="348" onclick="window.location.hash='#348'"></td><td class="FileContents-lineContents"><a name="348"></a><span class="pln">  </span><span class="com"># Apply gradients.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="349" onclick="window.location.hash='#349'"></td><td class="FileContents-lineContents"><a name="349"></a><span class="pln">  apply_gradient_op </span><span class="pun">=</span><span class="pln"> opt</span><span class="pun">.</span><span class="pln">apply_gradients</span><span class="pun">(</span><span class="pln">grads</span><span class="pun">,</span><span class="pln"> global_step</span><span class="pun">=</span><span class="pln">global_step</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="350" onclick="window.location.hash='#350'"></td><td class="FileContents-lineContents"><a name="350"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="351" onclick="window.location.hash='#351'"></td><td class="FileContents-lineContents"><a name="351"></a><span class="pln">  </span><span class="com"># Add histograms for trainable variables.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="352" onclick="window.location.hash='#352'"></td><td class="FileContents-lineContents"><a name="352"></a><span class="pln">  </span><span class="kwd">for</span><span class="pln"> var </span><span class="kwd">in</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">trainable_variables</span><span class="pun">():</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="353" onclick="window.location.hash='#353'"></td><td class="FileContents-lineContents"><a name="353"></a><span class="pln">    tf</span><span class="pun">.</span><span class="pln">histogram_summary</span><span class="pun">(</span><span class="pln">var</span><span class="pun">.</span><span class="pln">op</span><span class="pun">.</span><span class="pln">name</span><span class="pun">,</span><span class="pln"> var</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="354" onclick="window.location.hash='#354'"></td><td class="FileContents-lineContents"><a name="354"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="355" onclick="window.location.hash='#355'"></td><td class="FileContents-lineContents"><a name="355"></a><span class="pln">  </span><span class="com"># Add histograms for gradients.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="356" onclick="window.location.hash='#356'"></td><td class="FileContents-lineContents"><a name="356"></a><span class="pln">  </span><span class="kwd">for</span><span class="pln"> grad</span><span class="pun">,</span><span class="pln"> var </span><span class="kwd">in</span><span class="pln"> grads</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="357" onclick="window.location.hash='#357'"></td><td class="FileContents-lineContents"><a name="357"></a><span class="pln">    </span><span class="kwd">if</span><span class="pln"> grad</span><span class="pun">:</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="358" onclick="window.location.hash='#358'"></td><td class="FileContents-lineContents"><a name="358"></a><span class="pln">      tf</span><span class="pun">.</span><span class="pln">histogram_summary</span><span class="pun">(</span><span class="pln">var</span><span class="pun">.</span><span class="pln">op</span><span class="pun">.</span><span class="pln">name </span><span class="pun">+</span><span class="pln"> </span><span class="str">&#39;/gradients&#39;</span><span class="pun">,</span><span class="pln"> grad</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="359" onclick="window.location.hash='#359'"></td><td class="FileContents-lineContents"><a name="359"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="360" onclick="window.location.hash='#360'"></td><td class="FileContents-lineContents"><a name="360"></a><span class="pln">  </span><span class="com"># Track the moving averages of all trainable variables.</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="361" onclick="window.location.hash='#361'"></td><td class="FileContents-lineContents"><a name="361"></a><span class="pln">  variable_averages </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">train</span><span class="pun">.</span><span class="typ">ExponentialMovingAverage</span><span class="pun">(</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="362" onclick="window.location.hash='#362'"></td><td class="FileContents-lineContents"><a name="362"></a><span class="pln">      MOVING_AVERAGE_DECAY</span><span class="pun">,</span><span class="pln"> global_step</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="363" onclick="window.location.hash='#363'"></td><td class="FileContents-lineContents"><a name="363"></a><span class="pln">  variables_averages_op </span><span class="pun">=</span><span class="pln"> variable_averages</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="pln">tf</span><span class="pun">.</span><span class="pln">trainable_variables</span><span class="pun">())</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="364" onclick="window.location.hash='#364'"></td><td class="FileContents-lineContents"><a name="364"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="365" onclick="window.location.hash='#365'"></td><td class="FileContents-lineContents"><a name="365"></a><span class="pln">  </span><span class="kwd">with</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">control_dependencies</span><span class="pun">([</span><span class="pln">apply_gradient_op</span><span class="pun">,</span><span class="pln"> variables_averages_op</span><span class="pun">]):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="366" onclick="window.location.hash='#366'"></td><td class="FileContents-lineContents"><a name="366"></a><span class="pln">    train_op </span><span class="pun">=</span><span class="pln"> tf</span><span class="pun">.</span><span class="pln">no_op</span><span class="pun">(</span><span class="pln">name</span><span class="pun">=</span><span class="str">&#39;train&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="367" onclick="window.location.hash='#367'"></td><td class="FileContents-lineContents"><a name="367"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="368" onclick="window.location.hash='#368'"></td><td class="FileContents-lineContents"><a name="368"></a><span class="pln">  </span><span class="kwd">return</span><span class="pln"> train_op</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="369" onclick="window.location.hash='#369'"></td><td class="FileContents-lineContents"><a name="369"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="370" onclick="window.location.hash='#370'"></td><td class="FileContents-lineContents"><a name="370"></a></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="371" onclick="window.location.hash='#371'"></td><td class="FileContents-lineContents"><a name="371"></a><span class="kwd">def</span><span class="pln"> maybe_download_and_extract</span><span class="pun">():</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="372" onclick="window.location.hash='#372'"></td><td class="FileContents-lineContents"><a name="372"></a><span class="pln">  </span><span class="str">&quot;&quot;&quot;Download and extract the tarball from Alex&#39;s website.&quot;&quot;&quot;</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="373" onclick="window.location.hash='#373'"></td><td class="FileContents-lineContents"><a name="373"></a><span class="pln">  dest_directory </span><span class="pun">=</span><span class="pln"> FLAGS</span><span class="pun">.</span><span class="pln">data_dir</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="374" onclick="window.location.hash='#374'"></td><td class="FileContents-lineContents"><a name="374"></a><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">(</span><span class="pln">dest_directory</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="375" onclick="window.location.hash='#375'"></td><td class="FileContents-lineContents"><a name="375"></a><span class="pln">    os</span><span class="pun">.</span><span class="pln">makedirs</span><span class="pun">(</span><span class="pln">dest_directory</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="376" onclick="window.location.hash='#376'"></td><td class="FileContents-lineContents"><a name="376"></a><span class="pln">  filename </span><span class="pun">=</span><span class="pln"> DATA_URL</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">&#39;/&#39;</span><span class="pun">)[-</span><span class="lit">1</span><span class="pun">]</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="377" onclick="window.location.hash='#377'"></td><td class="FileContents-lineContents"><a name="377"></a><span class="pln">  filepath </span><span class="pun">=</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">dest_directory</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="378" onclick="window.location.hash='#378'"></td><td class="FileContents-lineContents"><a name="378"></a><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="kwd">not</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">path</span><span class="pun">.</span><span class="pln">exists</span><span class="pun">(</span><span class="pln">filepath</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="379" onclick="window.location.hash='#379'"></td><td class="FileContents-lineContents"><a name="379"></a><span class="pln">    </span><span class="kwd">def</span><span class="pln"> _progress</span><span class="pun">(</span><span class="pln">count</span><span class="pun">,</span><span class="pln"> block_size</span><span class="pun">,</span><span class="pln"> total_size</span><span class="pun">):</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="380" onclick="window.location.hash='#380'"></td><td class="FileContents-lineContents"><a name="380"></a><span class="pln">      sys</span><span class="pun">.</span><span class="pln">stdout</span><span class="pun">.</span><span class="pln">write</span><span class="pun">(</span><span class="str">&#39;\r&gt;&gt; Downloading %s %.1f%%&#39;</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> </span><span class="pun">(</span><span class="pln">filename</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="381" onclick="window.location.hash='#381'"></td><td class="FileContents-lineContents"><a name="381"></a><span class="pln">          float</span><span class="pun">(</span><span class="pln">count </span><span class="pun">*</span><span class="pln"> block_size</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln"> float</span><span class="pun">(</span><span class="pln">total_size</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">100.0</span><span class="pun">))</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="382" onclick="window.location.hash='#382'"></td><td class="FileContents-lineContents"><a name="382"></a><span class="pln">      sys</span><span class="pun">.</span><span class="pln">stdout</span><span class="pun">.</span><span class="pln">flush</span><span class="pun">()</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="383" onclick="window.location.hash='#383'"></td><td class="FileContents-lineContents"><a name="383"></a><span class="pln">    filepath</span><span class="pun">,</span><span class="pln"> _ </span><span class="pun">=</span><span class="pln"> urllib</span><span class="pun">.</span><span class="pln">request</span><span class="pun">.</span><span class="pln">urlretrieve</span><span class="pun">(</span><span class="pln">DATA_URL</span><span class="pun">,</span><span class="pln"> filepath</span><span class="pun">,</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="384" onclick="window.location.hash='#384'"></td><td class="FileContents-lineContents"><a name="384"></a><span class="pln">                                             reporthook</span><span class="pun">=</span><span class="pln">_progress</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="385" onclick="window.location.hash='#385'"></td><td class="FileContents-lineContents"><a name="385"></a><span class="pln">    </span><span class="kwd">print</span><span class="pun">()</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="386" onclick="window.location.hash='#386'"></td><td class="FileContents-lineContents"><a name="386"></a><span class="pln">    statinfo </span><span class="pun">=</span><span class="pln"> os</span><span class="pun">.</span><span class="pln">stat</span><span class="pun">(</span><span class="pln">filepath</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="387" onclick="window.location.hash='#387'"></td><td class="FileContents-lineContents"><a name="387"></a><span class="pln">    </span><span class="kwd">print</span><span class="pun">(</span><span class="str">&#39;Successfully downloaded&#39;</span><span class="pun">,</span><span class="pln"> filename</span><span class="pun">,</span><span class="pln"> statinfo</span><span class="pun">.</span><span class="pln">st_size</span><span class="pun">,</span><span class="pln"> </span><span class="str">&#39;bytes.&#39;</span><span class="pun">)</span></td></tr><tr class="u-pre u-monospace FileContents-line"><td class="u-lineNum u-noSelect FileContents-lineNum" data-line-number="388" onclick="window.location.hash='#388'"></td><td class="FileContents-lineContents"><a name="388"></a><span class="pln">    tarfile</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="pln">filepath</span><span class="pun">,</span><span class="pln"> </span><span class="str">&#39;r:gz&#39;</span><span class="pun">).</span><span class="pln">extractall</span><span class="pun">(</span><span class="pln">dest_directory</span><span class="pun">)</span></td></tr></table></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://code.google.com/p/gitiles/">Gitiles</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>